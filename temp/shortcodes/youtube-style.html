{{- $playlists_data := site.Data.youtube.playlists | default slice -}}
{{- $all_videos_data := site.Data.youtube.all_videos | default dict -}}
{{- $recent_videos_data := site.Data.youtube.recent_videos | default slice -}}
{{- $channel_data := site.Data.youtube.channel | default dict -}}

<div class="youtube-style-container">
  
  <!-- Секция последних видео -->
  {{- if $recent_videos_data -}}
    <div class="youtube-playlist-section" id="recent-videos">
      <div class="playlist-header">
        <h2 class="playlist-title">{{ i18n "latest_videos" | default "Последние видео" }}</h2>
        <div class="playlist-actions">
          <a href="https://www.youtube.com/channel/UC4MK6NjsSQSKMFXZl6ycdnQ/videos" 
             target="_blank" rel="noopener" class="play-all-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"/>
            </svg>
            {{ i18n "view_all" | default "Смотреть все" }}
          </a>
        </div>
      </div>
      
      <div class="video-carousel" data-playlist="recent">
        <button class="carousel-btn carousel-prev" aria-label="Previous">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
          </svg>
        </button>
        
        <div class="video-scroll">
          <div class="video-grid">
            {{- range first 8 $recent_videos_data -}}
              <div class="video-item">
                <div class="video-thumbnail">
                  {{- $thumbnail_url := "" -}}
                  {{- if .snippet.thumbnails.maxres -}}
                    {{- $thumbnail_url = .snippet.thumbnails.maxres.url -}}
                  {{- else if .snippet.thumbnails.high -}}
                    {{- $thumbnail_url = .snippet.thumbnails.high.url -}}
                  {{- else if .snippet.thumbnails.medium -}}
                    {{- $thumbnail_url = .snippet.thumbnails.medium.url -}}
                  {{- end -}}
                  
                  <a href="https://www.youtube.com/watch?v={{ .id }}" target="_blank" rel="noopener">
                    <img src="{{ $thumbnail_url }}" alt="{{ .snippet.title }}" loading="lazy">
                    <div class="play-overlay">
                      <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 5v14l11-7z"/>
                      </svg>
                    </div>
                    {{- if .contentDetails.duration -}}
                      {{- $duration := .contentDetails.duration | replaceRE "^PT" "" -}}
                      {{- $duration = $duration | replaceRE "H" ":" | replaceRE "M" ":" | replaceRE "S" "" -}}
                      <div class="duration">{{ $duration }}</div>
                    {{- end -}}
                  </a>
                </div>
                
                <div class="video-info">
                  <h3 class="video-title">
                    <a href="https://www.youtube.com/watch?v={{ .id }}" target="_blank" rel="noopener">
                      {{ .snippet.title }}
                    </a>
                  </h3>
                  <div class="video-meta">
                    {{- $channel_name := "МЄД (клуб медоїдів)" -}}
                    {{- if $channel_data.snippet.title -}}
                      {{- $channel_name = $channel_data.snippet.title -}}
                    {{- end -}}
                    <span class="channel-name">{{ $channel_name }}</span>
                    <div class="meta-stats">
                      {{- if .statistics.viewCount -}}
                        <span class="views">{{ .statistics.viewCount | humanize }} {{ i18n "views" }}</span>
                      {{- end -}}
                      <span class="date">• {{ dateFormat "2 Jan 2006" .snippet.publishedAt }}</span>
                    </div>
                  </div>
                </div>
              </div>
            {{- end -}}
          </div>
        </div>
        
        <button class="carousel-btn carousel-next" aria-label="Next">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
          </svg>
        </button>
      </div>
    </div>
  {{- end -}}

  <!-- Секции плейлистов -->
  {{- range $index, $playlist := $playlists_data -}}
    {{- $playlist_id := $playlist.id -}}
    {{- $playlist_videos := index $all_videos_data $playlist_id -}}
    {{- if $playlist_videos -}}
      {{- $videos := $playlist_videos.videos | default slice -}}
      {{- if gt (len $videos) 0 -}}
        
        <div class="youtube-playlist-section" id="playlist-{{ $playlist_id }}">
          <div class="playlist-header">
            <h2 class="playlist-title">{{ $playlist.snippet.title }}</h2>
            <div class="playlist-actions">
              <a href="https://www.youtube.com/playlist?list={{ $playlist_id }}" 
                 target="_blank" rel="noopener" class="play-all-btn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M8 5v14l11-7z"/>
                </svg>
                {{ i18n "play_all" }}
              </a>
            </div>
          </div>
          
          <div class="video-carousel" data-playlist="{{ $playlist_id }}">
            <button class="carousel-btn carousel-prev" aria-label="Previous">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
              </svg>
            </button>
            
            <div class="video-scroll">
              <div class="video-grid">
                {{- range first 12 $videos -}}
                  <div class="video-item">
                    <div class="video-thumbnail">
                      {{- $thumbnail_url := "" -}}
                      {{- if .snippet.thumbnails.maxres -}}
                        {{- $thumbnail_url = .snippet.thumbnails.maxres.url -}}
                      {{- else if .snippet.thumbnails.high -}}
                        {{- $thumbnail_url = .snippet.thumbnails.high.url -}}
                      {{- else if .snippet.thumbnails.medium -}}
                        {{- $thumbnail_url = .snippet.thumbnails.medium.url -}}
                      {{- end -}}
                      
                      <a href="https://www.youtube.com/watch?v={{ .id }}" target="_blank" rel="noopener">
                        <img src="{{ $thumbnail_url }}" alt="{{ .snippet.title }}" loading="lazy">
                        <div class="play-overlay">
                          <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                          </svg>
                        </div>
                        {{- if .contentDetails.duration -}}
                          {{- $duration := .contentDetails.duration | replaceRE "^PT" "" -}}
                          {{- $duration = $duration | replaceRE "H" ":" | replaceRE "M" ":" | replaceRE "S" "" -}}
                          <div class="duration">{{ $duration }}</div>
                        {{- end -}}
                      </a>
                    </div>
                    
                    <div class="video-info">
                      <h3 class="video-title">
                        <a href="https://www.youtube.com/watch?v={{ .id }}" target="_blank" rel="noopener">
                          {{ .snippet.title }}
                        </a>
                      </h3>
                      <div class="video-meta">
                        {{- $channel_name := "МЄД (клуб медоїдів)" -}}
                        {{- if $channel_data.snippet.title -}}
                          {{- $channel_name = $channel_data.snippet.title -}}
                        {{- end -}}
                        <span class="channel-name">{{ $channel_name }}</span>
                        <div class="meta-stats">
                          {{- if .statistics.viewCount -}}
                            <span class="views">{{ .statistics.viewCount | humanize }} {{ i18n "views" }}</span>
                          {{- end -}}
                          <span class="date">• {{ dateFormat "2 Jan 2006" .snippet.publishedAt }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                {{- end -}}
              </div>
            </div>
            
            <button class="carousel-btn carousel-next" aria-label="Next">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
              </svg>
            </button>
          </div>
        </div>
        
      {{- end -}}
    {{- end -}}
  {{- end -}}
</div>

<style>
.youtube-style-container {
  background: var(--theme);
  color: var(--primary);
  margin: 32px 0;
  padding: 24px;
  border-radius: 16px;
  border: 1px solid var(--border);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
}

.youtube-playlist-section {
  margin-bottom: 40px;
  background: var(--entry);
  border-radius: 12px;
  padding: 24px;
  border: 1px solid var(--border);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
}

.youtube-playlist-section:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 32px rgba(102, 126, 234, 0.15);
  border-color: var(--secondary);
}

/* Специальный стиль для секции "Последние видео" */
.youtube-playlist-section#recent-videos .playlist-title {
  background: linear-gradient(45deg, #ff6b6b, #ee5a24);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.youtube-playlist-section#recent-videos .play-all-btn {
  background: linear-gradient(45deg, #ff6b6b, #ee5a24);
}

.youtube-playlist-section#recent-videos .carousel-btn {
  background: linear-gradient(45deg, #ff6b6b, #ee5a24);
}

.playlist-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 2px solid var(--border);
}

.playlist-title {
  font-size: 1.5rem;
  font-weight: 600;
  margin: 0;
  color: var(--primary);
  background: linear-gradient(45deg, #667eea, #764ba2);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.play-all-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 20px;
  background: linear-gradient(45deg, #667eea, #764ba2);
  color: white;
  text-decoration: none;
  border-radius: 8px;
  font-size: 0.9rem;
  font-weight: 600;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.play-all-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(102, 126, 234, 0.4);
  color: white;
}

.video-carousel {
  position: relative;
  display: flex;
  align-items: center;
}

.carousel-btn {
  background: linear-gradient(45deg, #667eea, #764ba2);
  border: none;
  color: white;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  z-index: 2;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.carousel-btn:hover {
  transform: translateY(-50%) scale(1.1);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.carousel-btn:disabled {
  opacity: 0.3;
  cursor: not-allowed;
  pointer-events: none;
}

.carousel-prev {
  left: -24px;
}

.carousel-next {
  right: -24px;
}

.video-scroll {
  overflow-x: auto;
  overflow-y: hidden;
  scroll-behavior: smooth;
  scrollbar-width: none;
  -ms-overflow-style: none;
  margin: 0 24px;
  padding: 8px 0;
}

.video-scroll::-webkit-scrollbar {
  display: none;
}

.video-grid {
  display: flex;
  gap: 20px;
  padding: 8px 0;
}

.video-item {
  flex: 0 0 320px;
  max-width: 320px;
  background: var(--entry);
  border-radius: 12px;
  overflow: hidden;
  border: 1px solid var(--border);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
}

.video-item:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 32px rgba(102, 126, 234, 0.15);
  border-color: var(--secondary);
}

.video-thumbnail {
  position: relative;
  width: 100%;
  aspect-ratio: 16/9;
  overflow: hidden;
  background: #000;
}

.video-thumbnail img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.video-item:hover .video-thumbnail img {
  transform: scale(1.05);
}

.play-overlay {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 60px;
  height: 60px;
  background: rgba(255, 255, 255, 0.95);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: all 0.3s ease;
  color: #667eea;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.video-thumbnail:hover .play-overlay {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1.1);
}

.duration {
  position: absolute;
  bottom: 8px;
  right: 8px;
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 4px 8px;
  border-radius: 6px;
  font-size: 0.75rem;
  font-weight: 600;
}

.video-info {
  padding: 16px;
}

.video-title {
  margin: 0 0 8px 0;
  font-size: 0.95rem;
  font-weight: 600;
  line-height: 1.3;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.video-title a {
  color: var(--primary);
  text-decoration: none;
  transition: color 0.3s ease;
}

.video-title a:hover {
  color: #667eea;
}

.video-meta {
  font-size: 0.8rem;
  color: var(--secondary);
}

.channel-name {
  display: block;
  margin-bottom: 4px;
  font-weight: 500;
  color: var(--secondary);
}

.meta-stats {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

.views, .date {
  white-space: nowrap;
  font-size: 0.75rem;
}

/* Адаптивность */
@media (max-width: 768px) {
  .youtube-style-container {
    margin: 16px -8px;
    padding: 16px;
    border-radius: 12px;
  }
  
  .youtube-playlist-section {
    padding: 16px;
  }
  
  .video-item {
    flex: 0 0 280px;
    max-width: 280px;
  }
  
  .playlist-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }
  
  .playlist-title {
    font-size: 1.25rem;
  }
  
  .carousel-btn {
    display: none;
  }
  
  .video-scroll {
    margin: 0;
  }
}

@media (max-width: 480px) {
  .video-item {
    flex: 0 0 240px;
    max-width: 240px;
  }
  
  .video-title {
    font-size: 0.85rem;
  }
  
  .video-meta {
    font-size: 0.75rem;
  }
  
  .video-info {
    padding: 12px;
  }
  
  .play-all-btn {
    padding: 8px 16px;
    font-size: 0.85rem;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Карусель навигация
  const carousels = document.querySelectorAll('.video-carousel');
  
  carousels.forEach(carousel => {
    const prevBtn = carousel.querySelector('.carousel-prev');
    const nextBtn = carousel.querySelector('.carousel-next');
    const scrollContainer = carousel.querySelector('.video-scroll');
    
    if (prevBtn && nextBtn && scrollContainer) {
      const itemWidth = 340; // width of video item + gap
      
      function updateButtons() {
        const { scrollLeft, scrollWidth, clientWidth } = scrollContainer;
        const maxScroll = scrollWidth - clientWidth;
        
        // Обновляем состояние кнопок
        if (scrollLeft <= 0) {
          prevBtn.disabled = true;
          prevBtn.style.opacity = '0.3';
        } else {
          prevBtn.disabled = false;
          prevBtn.style.opacity = '1';
        }
        
        if (scrollLeft >= maxScroll - 10) {
          nextBtn.disabled = true;
          nextBtn.style.opacity = '0.3';
        } else {
          nextBtn.disabled = false;
          nextBtn.style.opacity = '1';
        }
      }
      
      prevBtn.addEventListener('click', () => {
        if (!prevBtn.disabled) {
          scrollContainer.scrollBy({
            left: -itemWidth,
            behavior: 'smooth'
          });
        }
      });
      
      nextBtn.addEventListener('click', () => {
        if (!nextBtn.disabled) {
          scrollContainer.scrollBy({
            left: itemWidth,
            behavior: 'smooth'
          });
        }
      });
      
      // Обновляем кнопки при скролле
      scrollContainer.addEventListener('scroll', updateButtons);
      
      // Инициализация
      updateButtons();
      
      // Обновляем кнопки при изменении размера окна
      window.addEventListener('resize', updateButtons);
    }
  });
});
</script> 